<script language="JavaScript">

    function extraRequiredFn(selector) {
        var existing = selector.parents('.form-group').find('label').html();
        if (!existing.includes("glyphicon-asterisk")) {
            selector.parents('.form-group')
                .find('label')
                .html(existing + '<span class="glyphicon glyphicon-asterisk" style="color: red;" aria-hidden="true">');
        }
    }

    function extraHideFn(selector) {
        selector.parents('.form-group').find('label').find('span').remove();
    }

    function noopFn(selector) {

    }

    $(document).ready(function() {

        var NULLABLE_BOOL_FIELD_YES = "true"

        $("#id_preferred_contact-contact_method").change(function() {
            var selectors = [
                $("#id_preferred_contact-first_name"),
                $("#id_preferred_contact-last_name"),
                $("#id_preferred_contact-phone"),
                $("#id_preferred_contact-email")
            ];
            if (this.value == "person") {
                showSelectors(selectors, extraRequiredFn);
            } else {
                hideSelectors(selectors, extraHideFn);
            }
        });

        $("#id_patient_insurance-private_health_fund").change(function() {
            if (this.value == "") {
                hide($("#id_patient_insurance-private_health_fund_number"), extraHideFn);
            } else {
                show($("#id_patient_insurance-private_health_fund_number"), extraRequiredFn);
            }
        });

        $("#id_patient_insurance-ndis_number").change(function() {
            if (this.value == "") {
                hide($("#id_patient_insurance-ndis_plan_manager"), extraHideFn);
                hide($("#id_patient_insurance-ndis_coordinator_first_name"), extraHideFn);
                hide($("#id_patient_insurance-ndis_coordinator_last_name"), extraHideFn);
                hide($("#id_patient_insurance-ndis_coordinator_phone"), extraHideFn);
            } else {
                show($("#id_patient_insurance-ndis_plan_manager"), extraRequiredFn);
            }
        });

        $("[name='primary_carer-relationship']").change(function() {
            if (this.value.trim() == "other") {
                show($('#id_primary_carer-relationship_info'), extraRequiredFn);
            } else {
                hide($('#id_primary_carer-relationship_info'), extraHideFn);
            }
        });

        $("#id_patient_insurance-ndis_plan_manager").change(function() {
            var selectors = [
                $("#id_patient_insurance-ndis_coordinator_first_name"),
                $("#id_patient_insurance-ndis_coordinator_last_name"),
                $("#id_patient_insurance-ndis_coordinator_phone")
            ];
            if (this.value == "other") {
                showSelectors(selectors, extraRequiredFn);
            } else {
                hideSelectors(selectors, extraHideFn);
            }
        });

        $("#id_patient_insurance-dva_card_number").change(function() {
            if (this.value.trim() == "") {
                hide($("#id_patient_insurance-dva_card_type"), extraHideFn);
            } else {
                show($("#id_patient_insurance-dva_card_type"), extraRequiredFn);
            }
        });

        $("#id_patient_insurance-referred_for_mac_care").change(function() {
            if (this.value.trim() != NULLABLE_BOOL_FIELD_YES) {
                hide($("#id_patient_insurance-needed_mac_level"), extraHideFn);
            } else {
                show($("#id_patient_insurance-needed_mac_level"), extraRequiredFn);
            }
        });

        $("#id_patient_insurance-eligible_for_home_care").change(function() {
            if (this.checked) {
                show($("#id_patient_insurance-receiving_home_care"), noopFn);
            } else {
                hide($("#id_patient_insurance-receiving_home_care"), noopFn);
            }
        });

        $("#id_patient_insurance-receiving_home_care").change(function() {
            if (this.checked) {
                show($("#id_patient_insurance-home_care_level"), extraRequiredFn);
            } else {
                hide($("#id_patient_insurance-home_care_level"), extraHideFn);
            }
        });

        $("#id_primary_carer-same_address").change(function() {
            var selectors = [
                $("#id_primary_carer-address"),
                $("#id_primary_carer-suburb"),
                $("#id_primary_carer-postcode")
            ];
            if (this.checked) {
                hideSelectors(selectors, extraHideFn);
            } else {
                showSelectors(selectors, noopFn);
            }
        });

        $("#id_primary_carer-is_emergency_contact").change(function(){
            var selectors = [
                $("#id_primary_carer-em_contact_first_name"),
                $("#id_primary_carer-em_contact_last_name"),
                $("#id_primary_carer-em_contact_phone")
            ];
            if (this.checked) {
                hideSelectors(selectors, extraHideFn);
            } else {
                showSelectors(selectors, noopFn);
            }
        });

        $("#id_preferred_contact-contact_method").trigger("change");
        $("#id_patient_insurance-private_health_fund").trigger("change");
        $("#id_patient_insurance-ndis_number").trigger("change");
        $("#id_primary_carer-relationship").trigger("change");
        $("#id_patient_insurance-ndis_plan_manager").trigger("change");
        $("#id_patient_insurance-dva_card_number").trigger("change");
        $("#id_patient_insurance-referred_for_mac_care").trigger("change");
        $("#id_patient_insurance-eligible_for_home_care").trigger("change");
        $("#id_patient_insurance-receiving_home_care").trigger("change");
        $("#id_primary_carer-same_address").trigger("change");
        $("#id_primary_carer-is_emergency_contact").trigger("change");

    });
</script>
